import os
from ament_index_python.packages import get_package_share_directory
from launch import LaunchDescription
from launch.actions import IncludeLaunchDescription, DeclareLaunchArgument
from launch.conditions import IfCondition, UnlessCondition
from launch.substitutions import LaunchConfiguration, PathJoinSubstitution
from launch_ros.actions import Node

def generate_launch_description():
    sim_arg = DeclareLaunchArgument('simulated', default_value='True', description='In Gazebo if True')
    map_name_arg = DeclareLaunchArgument('map_name', default_value='my_map.yaml', description='name of map file in robmob_bringup/config')

    map_config_path = PathJoinSubstitution([
        get_package_share_directory('robmob_bringup'), 'config', LaunchConfiguration('map_name')
    ])

    pkg_bringup = get_package_share_directory('robmob_bringup')

    # Initial localisation (algo monte-carlos localization)
    loc_launch = IncludeLaunchDescription(
        PathJoinSubstitution([pkg_bringup, 'launch', 'map_server_amcl.launch.py']),
        launch_arguments={
            'map_file': map_config_path,
            'use_sim_time': LaunchConfiguration('simulated')
        }.items()
    )

    return LaunchDescription([
        sim_arg,
        map_name_arg,
        loc_launch,
    ])